<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="search">

	<insert id="savePopular">
		insert into
		search_history(search_history_no,
		search_history_keyword)
		values(search_history_seq.nextval, #{keyword})
	</insert>

	<select id="showPopular" resultType="SearchHistoryDto">
		SELECT
		count(search_history_keyword) AS search_history_keyword_count,
		search_history_keyword
		FROM SEARCH_HISTORY GROUP BY
		search_history_keyword ORDER BY search_history_keyword_count desc
		fetch first 5 rows only
	</select>

	<delete id="delete">
		delete from search_history
	</delete>

	<insert id="saveRecent">
		INSERT INTO recent_history(recent_history_no,
		recent_history_keyword, recent_history_id)
		VALUES(recent_history_seq.nextval, #{keyword}, #{memberId})
	</insert>

	<select id="showRecent" resultType="SearchHistoryDto">
		SELECT MAX(search_history_time) AS
		search_history_time,
		search_history_keyword
		FROM search_history
		WHERE search_history_member_id = #{memberId}
		GROUP BY search_history_keyword
		ORDER BY search_history_time DESC
		FETCH FIRST 5 ROWS ONLY
	</select>

</mapper>